sudo: true
os: ubuntu
ubuntu: 
        - 18.04
env:
        - FLASK_CONFIG=staging 
before_install:
        - sudo apt-get update
matrix:
        include:
#               - language: node_js
#                 node_js: "11"
#                 before_install:
#                         - yarn cache clean
#                 install:
#                         - yarn install
#                 script:
#                         - echo "Hello chris"      
                                 #yarn cache clean
                                  #- yarn install
                - language: python
                  python: "3.7"
                  dist: "xenial"
                  sudo: true
                  install:
                        - pip install -r api/requirements.txt
                        - pip install -U pytest
                        - sudo apt install postgresql
                        - sudo apt install nginx
                  before_script:
                        - sudo service postgresql start
                        - sudo -u postgres dropdb --if-exists cc-staging
                        - sudo -u postgres dropuser --if-exists arco
                        - sudo -u postgres createuser -w arco
                        - sudo -u postgres createdb -O arco cc-staging 
                  script:
                        # - rm api/dev-db.sqlite4
                        # - rm api/migrations/versions/*.py
                        - flask db upgrade
                        - flask data load-all
                        - sudo nginx -t
                        - sudo systemctl restart nginx
                          #- ls -la ./api
                          #- rm api/dev-db.sqlite
                          #- rm api/migrations/versions/*.py
                          # - pytest
                          # - cd api/
                          # - rm dev-db.sqlite
                          # - rm migrations/versions/*.py
                          # - flask db upgrade
                          # - flask db migrate
                          # - flask db upgrade
                          # - flask data load-all

# reset database script (david)5
# run server side testing script (pytest)
# create script by configuration and make file
notifications:       
        slack: tumissionscomputing:wp25PPGEFitgDVKamhxxq6jU
deploy:
provider: linode
local-dir: public
branchs:
        only: 
                - development
