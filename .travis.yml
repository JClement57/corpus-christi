sudo: true
os: ubuntu
ubuntu: 
        - 18.04
env:
        global:
                - FLASK_CONFIG=staging-ci 
before_install:
        - sudo apt-get update
matrix:
        include:
                - language: node_js
                  node_js: "11"
                  #before_install:
                  script:
                        - cd ui/
                        - yarn cache clean
                        - yarn add cypress
                          #install:
                        - yarn install
                 #script:
                          #- cd ui/
                        - yarn build
                        - cd ../  
                          #- echo "Done with Node_js"  
                          #- cd ../
                - language: python
                  python: "3.7"
                  dist: "xenial"
                  sudo: true
                  env: 
                        - FLASK_APP=cc-api.py
                  install:
                        - pip install -r api/requirements.txt
                          #- pip install -U pytest
                        - cd api/
                        - sudo apt install postgresql
                        - sudo apt install nginx
                        - sudo service postgresql start
                  postgres:
                        adapter: postgresql
                        database: cc-staging
                  script:
                        - createuser arco
                        - createdb --owner=arco cc-staging
                          # - cp thing in to private.py
                        - ./private-ci.sh
                        - flask db upgrade
                        - flask data load-all
                        - sudo nginx -t
                        - sudo systemctl restart nginx
                        - cd ../
                        #- pytest

# create script by configuration and make file
# fix flask data load-al112
notifications:       
        slack: tumissionscomputing:wp25PPGEFitgDVKamhxxq6jU
deploy:
        provider: linode
        local-dir: public
        branches:
                only: 
                        - development
